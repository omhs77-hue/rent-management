# コンテキストとアーキテクチャ概要

## システムの目的
1人システム担当と GPT を活用し、現代的なクラウドサービスを組み合わせることで、賃貸管理における清掃検収・報告書管理・請求処理を省人化し、高生産性で運用する基盤を提供する。

## 基本方針
- **Supabase-first**: データストア・認証・ストレージを統合的に Supabase に集約し、サーバレス基盤として活用する。
- **Serverless-oriented**: Cloudflare Pages と GitHub Actions を中心に実行環境を構成し、専用サーバ管理を最小化する。
- **単一リポジトリ管理**: コードと設計を同一リポジトリで管理し、変更履歴の一元化とレビュー性を高める。
- **GPT / MCP の活用**: GPT を「実行環境と接続されたエージェント」として扱い、MCP を経由して安全にデータアクセスを行う。

## コンポーネントの役割
- **Supabase**: 物件・部屋・タスク・レポートメタデータの DB、ユーザ認証、レポートファイルの Storage を提供する中核基盤。
- **P1 (GitHub Actions)**: バッチ／クローラとして外部 Web サービスから清掃実績などを取得し、Supabase にタスクやレポートメタデータを書き込む。必要に応じてレポートの前処理や定期ジョブを担う。
- **P2 (Cloudflare Pages SPA)**: 業務 Web アプリとして、検収待ちタスクの一覧表示、ステータス更新、レポートダウンロードリンク提供などを行う。Supabase の DB/Storage を直接参照・更新する。
- **P3 (Supabase MCP サーバ)**: GPT が会話の中から Supabase にアクセスするための MCP ツールを提供し、データクエリや更新を代行する。

## バックエンドに対する考え方
- 初期フェーズでは専用 API サーバを持たず、Supabase のビューや RPC、Storage を業務ロジックの抽象レイヤとして活用する。
- フロントエンドやバッチは Supabase クライアントを通じて直接 DB へアクセスする。
- 将来的に要件が増した際は、Cloudflare Functions などで薄い API を追加し、セキュリティや結合度を適切に調整する方針とする。
